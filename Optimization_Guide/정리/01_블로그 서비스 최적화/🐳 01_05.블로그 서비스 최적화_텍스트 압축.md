# 🐳 01. 블로그 서비스 최적화

## 🌏 텍스트 압축

### 👉 production환경과 development환경

간과하면 안되는 것이 Lighthouse테스트를 진행한 환경이 `development환경`이라는 것이다.

`production 환경`에서는 webpack에서 경량화나 난독화 같은 추가 최적화 작업을 진행한다.<br/>그렇기 때문에 `development환경`과 차이가 있으므로 최종 서비스의 성능을 측정할 때는 실제 사용자에게 제공되는 `production환경`으로 **빌드된 서비스의 성능을 측정해야 한다.**

```shell
npm run build
```

`npm run start`가 아니라 `npm run build`로 서비스 코드를 번들링하고, 최종적으로 빌드된 파일을 서비스 하면 된다.<br/>(예제에서는 미리 세팅된 `npm run serve`명령어로 진행.)

<br/>

production 환경에서 상세페이지의 Lighthouse를 테스트 해보자.<br/>(코드 분할한 큰 패키지가 번들 파일에 있어 점수가 목록 페이지에 비해 낮을 수 있다.)

아래 항목의 `Enable text compression`을 짚고 가야한다.

> Enable text compression
>
> 서버로부터 리소스를 받을 떄 텍스트를 압축해서 받으라는 의미

현재 Transfer Size : 616.6KiB / Potential Savings : 403.8KiB로 텍스트 압축을 진행했을 때 전자에서 후자만큼 압축할 수 있다는 뜻이다.

<br/>

<br/>

### 👉 텍스트 압축이란?

웹페이지 로드시에 HTML,CSS, JS같은 텍스트 형태의 파일들을 다운로드 받는데, 이 파일의 크기가 크면 로딩이 완료되는데 오래걸린다.<br/>그렇기 때문에 이 리소스들을 코드 분할같은 최적화 기법으로 리소스 크기를 줄여보았었고, 텍스트 기반의 파일이기 때문에 텍스트 압축 기법으로 압축을 진행할 수 있다.

파일을 압축하여 작은 크기로 더 빠르게 전송 후 사용시점에 압축을 해제한다.<br/>=> 즉, 압축한 만큼 파일 사이즈가 작아져 리소스 전송시간도 단축된다.

압축 여부는 HTTP 응답 헤더에서 `Content-Encoding: gzip` 부분이 있다면 gzip형태로 압축되어 전송되었다는 뜻이다.

> 압축 방식
>
> 압축 방식에는 크게 `Gzip`과 `Deflate`가 있다.
>
> `Defalte`는 LZ77이란 알고리즘과 허프먼코딩을 사용해 데이터를 감싸는 인기있는 압축방식으로, <br/>`Gzip`은 블록화, 휴리스틱 필터링, 헤더와 체크섬과 함께 내부적으로 Deflate를 사용하는 압축방식이다.
>
> `Gzip`을 이용하는 것이 `Deflate`를 단독으로 사용하는 것 보다 더 좋은 압축률을 제공한다.

<br/>

### 👉 텍스트 압축 적용

serve명령어를 수정해 적용해볼 수 있다. (npx serve -help로 옵션확인 가능)

```json
"scripts": {
	...,
  "serve": "npm run build && node ./node_modules/serve/bin/serve.js -u -s build",
	...,
},
...
```

* -u : 텍스트 압축을 하지 않겠다는 옵션
* -s : SPA서비스를 위해 매칭되지 않는 주소는 모두 index.html로 보내겠다는 옵션

즉, -u옵션을 삭제하여 압축을 적용할 수 있다.

> 실제 서버에서 텍스트 압축 적용
>
> 다른 서버를 통해 번들 파일을 서비스 한다면, 해당 서버에 직접 텍스트 압축 설정을 해야한다.
>
> 만약, 단일 서버가 아닌 여러 서버를 이용한다면, Nginx와 같은 게이트웨이 서버에 공통적으로 텍스트 압축을 적용할 수도 있다.
