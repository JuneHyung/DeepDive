# 🐳 Important Defaults

TanStack Query는 기본적으로 설정값을 제공하고 있는데, 이를 모르면 처음 사용하는 사용제에게 예상치 못한 동작을 유발하거나 학습 및 디버깅을 어렵게 만들 수 있다.

❗ Tanstack Query를 사용할 때 다음 동작을 염두에 두세요.

* `useQuery` 또는 `useInfiniteQuery`를 통해 생성된 쿼리 인스턴스는 기본적으로 캐시된 데이터를 오래된(stale)된 것으로 간주함.

  * > 이 동작을 변경하려면 `staleTime`옵션을 사용하여 개별 쿼리 또는 전역적으로 설정할 ㅜ 있습니다. `staleTime`을 길게 설정하면 쿼리가 데이터를 다시 가져오는 빈도가 줄어든다.

* 오래된(stale) 쿼리는 다음의 경우에 자동으로 백그라운드에서 다시 가져온다.

  * 새로운 쿼리 인스턴스가 마운트될 때

  * 브라우저 창이 다시 포커스를 받을 때

  * 네트워크가 다시 연결될 때

  * 쿼리가 `refetchInterval`옵션으로 설정된 경우

  * > 이 기능을 변경하려면 `refetchOnMount`, `refetchOnWindowFocus`, `refetchOnReconnect` 및 `refetchInterval`과 같은 옵션을 사용할 수 있다.

* `useQuery`, `useInfiniteQuery` 또는 쿼리 옵저버에 의해 더 이상 활성 인스턴스가 없는 쿼리 결과는 `비활성(inactive)`상태로 표시되며, 나중에 다시 사용될 가능성에 대비해 캐시에 유지된다.

  * 기본적으로 5분후에 가비지 콜렉트된다.

  * > 이를 변경하려면 쿼리의 기본 **gcTime**을 1000 * 60 * 5 밀리초가 아닌 다른 값으로 변경할 수 있다.

* 실패한 쿼리는 오류를 캡처하여 UI에 표시하기 전에 기하급수적인 백오프 지연을 포함하여 자도응로 3번 재시도된다.

* 이 동작을 변경하려면 `retry` 및 `retryDelay` 옵션을 기본값인 3회 및 기본 **지수 백오프** 함수가 아닌 다른 값으로 설정할 수 있습니다.

* 기본적으로 쿼리 결과는 데이터가 실제 변경되었는지 감지하기 위해 구조적으로 공유되며, 그렇지 않은 경우 `useMemo` 및 `useCallback`과 관련된 값 안정화에 더 나은 도움을 주기 위해 데이터 참조는 변경되지 않은 상태로 유지된다.<br/>(99.9% 이 경우 이 기능을 비활성화할 필요가 없으며 이를 통해 앱 성능을 높일 수 있다.)

  * 구조적 공유는 JSON 호환 값에서만 작동하며 다른 값 유형은 항상 변경된 거으로 간주된다.
  * 예를 들어 큰 응답으로 인해 성능 문제가 발생하는 경우 `config.structuralSharing`플래그를 사용해 이 긴으을 비활성화 할 수 있다.
  * 쿼리 응답에서 JSON과 호환되지 않는 값을 처리하고 데이터가 변경되었는지 여부를 계속 감지하려는 경우 `config.structuralSharing`으로 고유한 사용자 지정 함수를 제공하여 참조를 유지하면서 이전 응답과 새 응답에서 값을 계산할 수 있다.

> 기본 지수 백오프 함수 ?
>
> 지수 백오프(Exponential Backoff)는 **요청이 실패할 때 마다 재시도 간격을 점점 늘려가는 방식**.
>
> TanstackQuery에서 네트워크 오류 등으로 인해 쿼리가 실패하면 처음에는 짧은 대기 시간 후 다시 시도하고, 실패할 때마다 대기 시간을 점점 증가 시킨다.



