# ğŸ³ ts-pattern

íŒ¨í„´ ë§¤ì¹­ì„ Typescriptí™˜ê²½ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬.

## ğŸŒê°œìš”

íŒ¨í„´ ë§¤ì¹­ì„ Typescriptí™˜ê²½ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬. <br/>(tc39ì—ì„œë„ ì œì•ˆí•˜ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬)

ì¡°ê±´ì— ë”°ë¼ ë‹¤ë¥¸ ë¡œì§ì„ ìˆ˜í–‰í•´ì•¼í•  ë•Œ? â†’ `ifë¬¸`, `switchë¬¸`, ...  â†’ ë³µì¡í•´ì§€ëŠ” ì¡°ê±´ë“¤ â†’ ë¶„ê¸°ë¬¸ì´ ë§ì•„ì§€ê³ , ìœ ì§€ë³´ìˆ˜ëŠ” ë” ì–´ë ¤ì›Œì§. + TSì—ì„œëŠ” íƒ€ì…ì´ ì¶”ê°€ë  ë•Œë§ˆë‹¤ ëª¨ë“  ë¶„ê¸° ì¡°ê±´ì„ ë‹¤ ì‹ ê²½ì¨ì•¼í•˜ë©°, ì´ë¥¼ ë†“ì³¤ì„ë•Œ ë²„ê·¸ ë°œìƒ.

`ts-pattern`ì€ ì´ëŸ° ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ ë„ì…ë˜ì—ˆê³ , TC39ì—ì„œ ì œì•ˆí•œ íŒ¨í„´ ë§¤ì¹­ì„ ê¸°ë°˜ìœ¼ë¡œ í•˜ê³  ìˆìŒ.

> íŒ¨í„´ë§¤ì¹­
>
> ë°ì´í„°ë¥¼ ê²€ìƒ‰í•  ë•Œ íŠ¹ì • íŒ¨í„´ì´ ì¶œí˜„í•˜ëŠ”ì§€, ë˜ ì–´ë””ì— ì¶œí˜„í•˜ëŠ”ì§€ ë“±ì„ íŠ¹ì •í•˜ëŠ” ë°©ë²•.
>
> ê²€ìƒ‰, ë¶„ì„, ì •ê·œí™”, ì¶”ì¸¨ ë“± ë‹¤ì–‘í•œ ë¶„ì•¼ì—ì„œ ì‚¬ìš©í•˜ê³  ìˆìœ¼ë©°, JSì—ì„œë„ ì •ê·œí‘œí˜„ì‹ì„ í™œìš©í•˜ì—¬ ë¬¸ìì—´ì—ì„œ íŠ¹ì • íŒ¨í„´ì„ ì°¾ì•„ ê²€ìƒ‰, ì¶”ì¶œ, ëŒ€ì²´ë“±ì„ ìˆ˜í–‰í•  ë•Œ ì‚¬ìš©í•˜ëŠ” ê°œë…ì´ë‹¤.
>
> Javascriptì—ì„œ íŒ¨í„´ë§¤ì¹­ì€ ì•„ì§ Stage1ì´ê¸° ë•Œë¬¸ì— ë¼ì´ë¸ŒëŸ¬ë¦¬ì˜ ë„ì›€ì„ ë°›ì•„ì•¼ í•œë‹¤.

![npm-trends-ts-patterns](./images/npm-trend-ts-pattern.jpg)

<br/><br/>

## ğŸŒ ì–´ë–»ê²Œ ì‚¬ìš©í• ê¹Œ?

```ts
import { match } from 'ts-pattern';

const value = [1, 2, 3];

const result = match(value)
  .with([1, 2, 3, 4], () => 'it is [1, 2, 3, 4]')
  .with([1, 2, 3], () => 'it is [1, 2, 3]')
  .with([1, 2], () => 'it is [1, 2]')
  .run();

console.log(result); // it is [1, 2, 3]
```

### ğŸ‘‰ match(value)

`ts-pattern`ì´ ë‚´ë¶€ì ìœ¼ë¡œ `MatchExpression`ì´ë€ í´ë˜ìŠ¤ë¥¼ ì‚¬ìš©í•´ ë§¤ì¹­ì„ ì²˜ë¦¬í•¨.

ì´ í´ë˜ìŠ¤ì˜ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìƒì„±í•˜ì—¬ ë°˜í™˜í•´ì£¼ëŠ” ê°„ë‹¨í•œ í•¨ìˆ˜. â†’ í•­ìƒ ì„ í–‰ ë˜ì–´ì•¼ í•œë‹¤.

### ğŸ‘‰ with(pattern, [...patterns], handler)

ì…ë ¥ê°’ì„ íŒ¨í„´ë³„ë¡œ ë§¤ì¹­ ì‹œì¼œì£¼ëŠ” ë©”ì„œë“œ

íŒ¨í„´ ì¸ìì˜ íƒ€ì…ì€ ì¼ë°˜ì ìœ¼ë¡œ ì…ë ¥ê°’ì˜ íƒ€ì…ì— ì˜í•´ ê²°ì •ëœë‹¤.

```ts
import { match } from 'ts-pattern';

const upperCase: string = 'A';
const printUpper = () => 'it is upper';
const printLower = () => 'it is lower';

const first = match(upperCase)
  .with('a', printLower)
  .with('b', printLower)
  .with('A', printUpper)
  .with('B', printUpper)
  .otherwise(() => 'where is it?');

const second = match(upperCase)
  .with('a,', 'b', printLower)
  .with('A', 'B', printUpper)
  .otherwise(() => 'where is it?');

console.log(first); // 'it is upper'
console.log(second); // 'it is upper'
```

ì´ì²˜ëŸ¼ `.with()`ëŠ” ì²´ì´ë‹ ë˜ëŠ”ê²ƒ ì²˜ëŸ¼ **í˜¸ì¶œ ìˆœì„œê°€ ìœ„ì—ì„œ ì•„ë˜**ë¡œ íë¥¸ë‹¤. ì¤‘ì²©ê°ì²´  ì²˜ëŸ¼ ë³µì¡í•œ êµ¬ì¡°ë¥¼ ê°€ì§„ íŒ¨í„´ë“¤ì„ ê²€ì‚¬í•˜ê³ ì í•œë‹¤ë©´, **í•­ìƒ ì„¸ë¶€ì ì¸ í˜•íƒœì˜ íŒ¨í„´ì€ ë¨¼ì € ê²€ì‚¬ë¥¼ í•´ì•¼í•œë‹¤.**

### ğŸ‘‰ exhaustive(), otherwise(), run()

ì´ ë©”ì„œë“œë“¤ì€ ê²°ê³¼ë¥¼ ë°˜í™˜í•˜ê¸° ìœ„í•´ì„œëŠ” ë°˜ë“œì‹œ ì¨ì•¼í•˜ê¸° ë•Œë¬¸ì— íŠ¹ì§•ë“¤ì„ ì˜ ì•Œê³  ã…£ã…‡ã…†ì–´ì•¼ í•œë‹¤.

| ë©”ì„œë“œ                                                    | ì„¤ëª…                                                         |
| :-------------------------------------------------------- | :----------------------------------------------------------- |
| `exhaustive(): TOutput`                                   | - **ì…ë ¥ ê°’ê³¼ ì¼ì¹˜í•˜ëŠ” íŒ¨í„´ì´ ì—†ìœ¼ë©´ íƒ€ì… ì²´í¬ê°€ ì‹¤íŒ¨í•œë‹¤.** (ì² ì €í•œ íƒ€ì… ì²´í¬, Exhaustiveness Type Check) - **ì¼ì¹˜í•˜ëŠ” íŒ¨í„´ì´ ëŸ°íƒ€ì„ì— ê¼­ ìˆì–´ì•¼ í•œë‹¤.** (ê·¸ë ‡ì§€ ì•Šìœ¼ë©´ ì˜¤ë¥˜ê°€ ë°œìƒí•œë‹¤.) |
| `otherwise(handler: (value: TInput) => TOutput): TOutput` | - **ì¼ì¹˜í•˜ëŠ” íŒ¨í„´ì´ ì—†ì„ ê²½ìš°ì— ì‹¤í–‰ëœë‹¤.** - `switch`ì˜ `default`ë¡œ ìƒê°í•˜ë©´ í¸í•˜ë‹¤. |
| `run(): TOutput`                                          | - **ì¼ì¹˜í•˜ëŠ” íŒ¨í„´ì´ ëŸ°íƒ€ì„ì— ê¼­ ìˆì–´ì•¼ í•œë‹¤.** (ê·¸ë ‡ì§€ ì•Šìœ¼ë©´ ì˜¤ë¥˜ê°€ ë°œìƒí•œë‹¤.) |

<br/>

### ğŸ‘‰ isMatching(pattern, value?)

`isMatching`ì€ íƒ€ì… ê°€ë“œ í•¨ìˆ˜ì´ë‹¤.

- `isMatching(pattern, value): boolean`: íŒ¨í„´ê³¼ ê°’ì˜ ë§¤ì¹˜ê°€ ì„±ê³µí•˜ë©´ ê²°ê³¼ë¥¼ `boolean` ê°’ìœ¼ë¡œ ì•Œë ¤ì¤€ë‹¤.
- `isMatching(pattern): (value) => boolean` : íŒ¨í„´ë§Œ ë„£ê³  í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•˜ë©´ í•´ë‹¹ íŒ¨í„´ì— ëŒ€í•œ íƒ€ì… ê°€ë“œ í•¨ìˆ˜ê°€ ë°˜í™˜ëœë‹¤.

ì»¤ë§ì´ ëœ ë²„ì „

```ts
import { isMatching } from 'ts-pattern';

const isDiscountProduct = isMatching({
  salePrice: P.number.gt(0),
  discountedSalePrice: P.number.gt(0),
});

if (isDiscountProduct(res.data)) {
  // do something!
}
```

### ğŸ‘‰ Patterns

`.with`ì™€ `isMatching`ì˜ ì¸ìë¡œ ë“¤ì–´ê°€ëŠ” íŒ¨í„´ë“¤

- **`Literals`**
- **`Wildcards`**
- **`Objects`**
- **`Tuples (arrays)`**
- **`Sets`**
- **`Maps`**
- **`P.array patterns`**
- **`P.when patterns`**
- **`P.not patterns`**
- **`P.select patterns`**
- **`P.optional patterns`**
- **`P.instanceOf patterns`**
- **`P.union patterns`**
- **`P.intersection patterns`**
- **`P.string predicates`**
- **`P.number and P.bigint predicates`**

<br/><br/>

## ğŸŒ ifë¬¸ì„ ëŒ€ì²´ í•  ìˆ˜ ìˆì„ê¹Œ?

[ts-pattern-benchmark](https://github.com/bdbaraban/ts-pattern-benchmark)

ìµœê·¼ ts-pattern ë²¤ì¹˜ë§ˆí¬ì— ë”°ë¥´ë©´ ê¸°ë³¸ `if/else`, `switch`, `ì‚¼í•­ì—°ì‚°ì`ì— ë¹„í•´ ì„±ëŠ¥ì´ í˜„ì €íˆ ë–¨ì–´ì§„ë‹¤.

`if/else`ëŠ” ì´ˆë‹¹ ì•½ 10ì–µíšŒ ì´ìƒ ì—°ì‚°ì„ ì²˜ë¦¬í•  ìˆ˜ ìˆì§€ë§Œ, `ts-pattern`ì˜ `.exhaustive()`,`.otherwise()`, `.run()`ê°™ì€ ë©”ì„œë“œëŠ” ì´ˆë‹¹ 130ë§ŒíšŒ ì •ë„ì˜ ì—°ì‚°ì„ ìˆ˜í–‰í•˜ë©° 99%ë” ëŠë ¤ì§„ë‹¤.

### ğŸ‘‰ ì›ì¸

`ts-pattern`ì€ ë‹¤ì–‘í•œ ë°ì´í„° êµ¬ì¡°ì™€ ë³µì¡í•œ íƒ€ì… ì¶”ë¡ ì„ ì§€ì›í•˜ê¸° ìœ„í•´ ì…ë ¥ íƒ€ì…ì˜ ê°€ëŠ¥í•œ ëª¨ë“  ê²½ìš°ë¥¼ ì‚¬ì „ì— ê³„ì‚°í•˜ëŠ”ë°, ë‚´ë¶€ ì½”ë“œë¥¼ ë´¤ì„ ë•Œ `match.ts`ì—ì„œ í´ë˜ìŠ¤ ê¸°ë°˜ìœ¼ë¡œ íŒ¨í„´ ë§¤ì¹­ì„ êµ¬í˜„í•˜ê³ , thisë¥¼ ì‚¬ìš©í•´ ìƒíƒœë¥¼ í•¨ìˆ˜ ì²´ì´ë‹ì„ í†µí•´ ê³µìœ í•˜ì—¬ ì•ˆì „í•œ íƒ€ì… ë§¤ì¹­ì„ ì œê³µí•˜ê¸° ë•Œë¬¸ì— ê¸°ë³¸ `if/else`ë³´ë‹¤ ì„±ëŠ¥ì´ ë–¨ì–´ì§ˆ ìˆ˜ ë°–ì— ì—†ë‹¤.

### ğŸ‘‰ ì‹¤ì œë¡œ?

ë³µì¡í•œ ë¶„ê¸° ë¡œì§ì´ë‚˜ íƒ€ì…ì²´í¬ê°€ í•„ìš”í•œ ìƒí™©ì—ì„œëŠ” í° ë„ì›€ì´ ë˜ì—ˆì§€ë§Œ, ëŒ€ë¶€ë¶„ ë³µì¡í•˜ì§€ ì•Šì€ ì½”ë“œì—ì„œ ì‚¬ìš©ë˜ê³  ìˆì—‡ê³  ì˜¤íˆë ¤ ì˜¤ë²„ì—”ì§€ë‹ˆì–´ë§ì²˜ëŸ¼ ëŠê»´ì§„ë‹¤.

<br/>

## ğŸŒ ë³µì¡í•œ ë¶„ê¸°ë¬¸ì„ ê°„ê²°í•˜ê³  ì•ˆì „í•˜ê²Œ ì²˜ë¦¬í•˜ëŠ” ë°©ë²•

### ğŸ‘‰ 1. ë‹¨ìˆœí•˜ê³  ì•ˆì „í•˜ê²Œ ì²˜ë¦¬í•˜ê¸°

ë³µì¡í•œ ë¶„ê¸°ëŠ” í”¼í•  ìˆ˜ ìˆë‹¤ë©´ `if/else`, ë˜ëŠ” `switch`ë¡œ ë‹¨ìˆœí•˜ê²Œ í‘œí˜„í•˜ëŠ” ê²ƒì´ ì¢‹ë‹¤.

```ts
type ê°€ìœ„ë°”ìœ„ë³´íƒ€ì… = 'ê°€ìœ„' | 'ë°”ìœ„' | 'ë³´';

function ê°€ìœ„ë°”ìœ„ë³´ì²˜ë¦¬(union: ê°€ìœ„ë°”ìœ„ë³´íƒ€ì…) {
  switch (union) {
    case 'ê°€ìœ„':
      console.log("âœŒï¸ ê°€ìœ„ë¥¼ ì„ íƒí•˜ì…¨ìŠµë‹ˆë‹¤.");
      break;
    case 'ë°”ìœ„':
      console.log("âœŠ ë°”ìœ„ë¥¼ ì„ íƒí•˜ì…¨ìŠµë‹ˆë‹¤.");
      break;
    case 'ë³´':
      console.log("ğŸ– ë³´ë¥¼ ì„ íƒí•˜ì…¨ìŠµë‹ˆë‹¤.");
      break;
    default:
      // íƒ€ì…ìŠ¤í¬ë¦½íŠ¸ê°€ ëª¨ë“  ì¼€ì´ìŠ¤ë¥¼ ì²˜ë¦¬í–ˆëŠ”ì§€ í™•ì¸í•˜ëŠ” ê²€ì¦
      union satisfies never; 
      neverCheck(union);
  }
}

function neverCheck(v: never) {
  // ì—¬ê¸°ì— ì ì ˆí•œ ì—ëŸ¬ ì²˜ë¦¬ë¥¼ ë„£ìŠµë‹ˆë‹¤.
}
```

* `union satisfies never` : <br/>`union`íƒ€ì… ì´ì™¸ì— ì²˜ë¦¬ë˜ì§€ ì•Šì€ ë‹¤ë¥¸ ì¼€ì´ìŠ¤ê°€ ì—†ëŠ”ì§€ë¥¼ íƒ€ì… ì‹œìŠ¤í…œì—ì„œ ê°•ì œ. ë§Œì•½ ìƒˆë¡œìš´ íƒ€ì…ì´ ì¶”ê°€ë˜ì—ˆëŠ”ë° ì²˜ë¦¬ë˜ì§€ ì•Šì•˜ë‹¤ë©´, Typescript ê²½ê³ ë¥¼ ë°œìƒì‹œì¼œ ì½”ë“œ ì•ˆì •ì„±ì„ ë†’ì¼ ìˆ˜ ìˆë‹¤.<br/>ë§Œì•½ ì²˜ë¦¬ë˜ì§€ ì•Šì€ ì¼€ì´ìŠ¤ê°€ ìˆë‹¤ë©´, neverCheck()ê°™ì€ ì½”ë“œë¡œ ëŸ°íƒ€ì„ì—ëŸ¬ë¥¼ ë°œìƒì‹œí‚¤ê³ , ì´ë¥¼ `ErrorBoundary`ë‚˜ `Sentry`ì™€ ì—°ë™í•˜ì—¬ ë”ìš± ì•ˆì •ì ì¸ ì—ëŸ¬ ì²˜ë¦¬ì™€ ëª¨ë‹ˆí„°ë§ì´ ê°€ëŠ¥í•˜ë‹¤.

<br/>

### ğŸ‘‰ JSXì½”ë“œì—ì„œ ì„ ì–¸ì  ë¶„ê¸° ì²˜ë¦¬(Typescript)

matchì¸í„°í˜ì´ìŠ¤ì™€ ì²´ì´ë‹ì„ í†µí•´ ì½”ë“œë¥¼ ì„ ì–¸ì ìœ¼ë¡œ ì“¸ ìˆ˜ ìˆë‹¤ëŠ” ì¥ì ì´ ìˆë‹¤.

```ts
import { match } from 'ts-pattern';

type ê°€ìœ„ë°”ìœ„ë³´íƒ€ì… = 'ê°€ìœ„' | 'ë°”ìœ„' | 'ë³´';

const ê°€ìœ„ë°”ìœ„ë³´ = ({ choice }: { choice: ê°€ìœ„ë°”ìœ„ë³´íƒ€ì… }) => {
  return (
    <div>
      {
        match(choice)
          .with('ê°€ìœ„', () => <div>âœŒï¸ ê°€ìœ„ë¥¼ ì„ íƒí•˜ì…¨ìŠµë‹ˆë‹¤!</div>)
          .with('ë°”ìœ„', () => <div>âœŠ ë°”ìœ„ë¥¼ ì„ íƒí•˜ì…¨ìŠµë‹ˆë‹¤!</div>)
          .with('ë³´', () => <div>ğŸ– ë³´ë¥¼ ì„ íƒí•˜ì…¨ìŠµë‹ˆë‹¤!</div>)
          .exhaustive()  // ëª¨ë“  ê°€ëŠ¥í•œ ê°’ì´ ì²˜ë¦¬ë˜ì—ˆëŠ”ì§€ ì²´í¬
      }
    </div>
  );
};
```

## ğŸ“˜ ì°¸ê³ 

* [Blog - ts-pattern](https://www.kimcoder.io/blog/ts-pattern)
* [Toss Tech Blog](https://toss.tech/article/ts-pattern-usage)
* [TC39 - proposal-pattern-matching](https://github.com/tc39/proposal-pattern-matching?tab=readme-ov-file#userland-matching)